<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;code&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="code">code</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="overview">Overview</h1>

<p>This specification describes a
<a href="http://en.wikipedia.org/wiki/Hooking">&ldquo;hook&rdquo;</a>-based pattern for invoking
decision support from within a clinician&rsquo;s EHR workflow. The API supports:</p>

<ul>
<li>Synchronous, workflow-triggered CDS calls returning information and suggestions</li>
<li>Launching a user-facing SMART app when CDS requires deeper interaction</li>
<li>Long-running, non-modal CDS sessions that observe EHR activity in progress</li>
</ul>

<h2 id="how-it-works">How it works</h2>

<p>User activity inside the EHR triggers <strong>CDS hooks</strong> in real-time.  For example:</p>

<ul>
<li><code class="prettyprint">patient-view</code> when opening a new patient record</li>
<li><code class="prettyprint">medication-prescribe</code> on authoring a new prescription</li>
<li><code class="prettyprint">order-review</code> on viewing pending orders for approval</li>
</ul>

<p>When a triggering activity occurs, the EHR notifies each CDS service registered for the activity. These services must then provide near-real-time feedback about the triggering event. Each service gets basic details about the EHR
context (via the <code class="prettyprint">context</code> parameter of the hook) plus whatever
service-specific data are required (via the <code class="prettyprint">pre-fetch-template</code> parameter).</p>

<p><img alt="CDS Hooks Overview" src="images/overview-with-decisions.png" /></p>

<h2 id="cds-cards">CDS Cards</h2>

<p>Each CDS service can return any number of <strong>cards</strong> in response to the hook.
Cards convey some combination of text (<em>information card</em>), alternative
suggestions (<em>suggestion card</em>), and links to apps or reference
materials (<em>app link card</em>). A user sees these cards — one or more of each type
— embedded in the EHR, and can interact with them as follows:</p>

<ul>
<li><p><em>information card</em>: provides text for the user to read.</p></li>
<li><p><em>suggestion card</em>: provides a specific suggestion for which the EHR renders a button that the user can click to accept. Clicking automatically populates the suggested change into the EHR&rsquo;s UI.</p></li>
<li><p><em>app link card</em>: provides a link to a SMART app where the user can supply details, step through a flowchart, or do anything else required to help reach an informed decision. When the user has finished, flow returns to the EHR. At that point, the <strong>EHR re-triggers the initial CDS hook</strong>. The re-triggering may result in different cards, and may also include <strong>decisions</strong> (see below).</p></li>
</ul>

<h2 id="cds-decisions">CDS Decisions</h2>

<p>In addition to cards, a CDS service may also return <strong>decisions</strong> — but only
after a user has interacted with the service via an <em>app link card</em>.
Returning a decision allows the the CDS service to communicate the user&rsquo;s choices  to the EHR without displaying an additional card.  For
example, a user might launch a hypertension management app, and upon
returning to the EHR&rsquo;s prescription page she expects her new blood pressure
prescription to &ldquo;just be there&rdquo;. By returning a decision <em>instead of a card</em>,
the CDS service achieves this expected behavior. (<em>Note:</em> To return a
decision after a user interaction, the CDS service must maintain state
associated with the request&rsquo;s <code class="prettyprint">hookInstance</code>;
when the EHR invokes the hook for a second time with the same
<code class="prettyprint">hookInstance</code>, the service can respond with decisions on as well as cards.)</p>

          <h1 id="cds-services">CDS Services</h1>

<h2 id="discovery">Discovery</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://example.com/.well-known/cds-services"</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"services"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"hook"</span><span class="p">:</span><span class="w"> </span><span class="s2">"patient-view"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Static CDS Service Example"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"An example of a CDS service that returns a static set of cards"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"static-patient-greeter"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"prefetch"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"patientToGreet"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/{{Patient.id}}"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"hook"</span><span class="p">:</span><span class="w"> </span><span class="s2">"medication-prescribe"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Medication Echo CDS Service"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"An example of a CDS service that simply echos the medication being prescribed"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"medication-echo"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"prefetch"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"patient"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/{{Patient.id}}"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"medications"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MedicationOrder?patient={{Patient.id}}"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Developers of CDS Services must provide a well-known endpoint allowing the EHR to discover all available CDS Services, including information such as the purpose of the CDS Service, when it should be invoked, and any data that is requested to be prefetched.</p>

<h3 id="http-request">HTTP Request</h3>

<p>The discovery endpoint is always available at <code class="prettyprint">{baseUrl}/.well-known/cds-services</code>. For example, if the <code class="prettyprint">baseUrl</code> is https://example.com, the EHR would invoke:</p>

<p><code class="prettyprint">GET https://example.com/.well-known/cds-services</code></p>

<aside class="notice">
The URI path prefix of /.well-known/ is defined by <a href="https://tools.ietf.org/html/rfc5785">RFC 5785</a> for the sole purpose of expressing static, well-known URLs.
</aside>

<h3 id="response">Response</h3>

<p>The response to the discovery endpoint is an object containing a list of CDS Services.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">services</code> <em>array</em></td>
<td>An array of <em>CDS Services</em></td>
</tr>
</tbody></table>

<p>Each CDS Service is described by the following attributes.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">hook</code> <em>string</em></td>
<td>The hook this service should be invoked on<br />(todo: link to hook documentation)</td>
</tr>
<tr>
<td><code class="prettyprint">name</code> <em>string</em></td>
<td>The name of this service</td>
</tr>
<tr>
<td><code class="prettyprint">description</code> <em>string</em></td>
<td>The description of this service</td>
</tr>
<tr>
<td><code class="prettyprint">id</code> <em>string</em></td>
<td>The {id} portion of the URL to this service which is available at<br /><code class="prettyprint">{baseUrl}/cds-services/{id}</code></td>
</tr>
<tr>
<td><code class="prettyprint">prefetch</code> <em>object</em></td>
<td>An object containing key/value pairs of FHIR queries to data<br />that this service would like the EHR prefetch and provide on<br />each service call. The key is a <em>string</em> that describes the type<br />of data being requested and the value is a <em>string</em> representing<br />the FHIR query.<br />(todo: link to prefetching documentation)</td>
</tr>
</tbody></table>

<h3 id="http-status-codes">HTTP Status Codes</h3>

<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">200 OK</code></td>
<td>A successful response</td>
</tr>
</tbody></table>

<h2 id="calling-a-cds-service">Calling a CDS Service</h2>
<pre class="highlight shell"><code><span class="o">{</span>
  hookInstannce:          1..1,
  hook:                   1..1,
  fhirServer:             0..1,
  oauth:                  0..1 <span class="o">{</span>
    token:                1..1,
    scope:                1..1,
    expires:              1..1
  <span class="o">}</span>,
  redirect:               1..1,
  user:                   0..1,
  patient:                0..1,
  encounter:              0..1,
  context:                0..<span class="k">*</span> resource<span class="o">(</span>Any<span class="o">)</span>,
  prefetch:               0..1 <span class="o">{</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<pre class="highlight plaintext"><code>curl "https://example.com/cds-services/static-patient-greeter"
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
   </span><span class="nt">"hookInstance"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"d1577c69-dfbe-44ad-ba6d-3e05e953b2ea"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"fhirServer"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hooks.smarthealthit.org:9080"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"hook"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"patient-view"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"redirect"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hooks2.smarthealthit.org/service-done.html"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"user"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Practitioner/example"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"context"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
   </span><span class="nt">"patient"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1288992"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"prefetch"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"patientToGreet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nt">"response"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"200 OK"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"resource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"resourceType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"gender"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"male"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"birthDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1925-12-23"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1288992"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"active"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p>The CDS Hook call includes the following input fields:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">hook</code><em>string</em> or <em>URL</em></td>
<td>The hook that triggered this CDS Service call<br />(todo: link to hook documentation)</td>
</tr>
<tr>
<td><code class="prettyprint">hookInstance</code> <em>string</em></td>
<td>A UUID for this particular hook call (see more information below)</td>
</tr>
<tr>
<td><code class="prettyprint">fhirServer</code> <em>URL</em></td>
<td>The base URL EHR&rsquo;s <a href="https://www.hl7.org/fhir/">FHIR</a> server. The scheme should be <code class="prettyprint">https</code></td>
</tr>
<tr>
<td><code class="prettyprint">oauth</code> <em>string</em></td>
<td>The OAuth2 access token providing access to the EHR&rsquo;s FHIR server (see more information below)</td>
</tr>
<tr>
<td><code class="prettyprint">redirect</code> <em>URL</em></td>
<td>The URL an app link card should redirect to (see more information below)</td>
</tr>
<tr>
<td><code class="prettyprint">user</code> <em>string</em></td>
<td>The FHIR resource type + id representing the current user.<br />The type is one of: <a href="https://www.hl7.org/fhir/practitioner.html">Practitioner</a>, <a href="https://www.hl7.org/fhir/patient.html">Patient</a>, or <a href="https://www.hl7.org/fhir/relatedperson.html">RelatedPerson</a>.<br />For example, <code class="prettyprint">Practitioner/123</code></td>
</tr>
<tr>
<td><code class="prettyprint">patient</code> <em>string</em></td>
<td>The <a href="https://www.hl7.org/fhir/patient-definitions.html#Patient.identifier">FHIR Patient identifier</a> attribute of the current patient in context</td>
</tr>
<tr>
<td><code class="prettyprint">encounter</code> <em>string</em></td>
<td>The <a href="https://www.hl7.org/fhir/encounter-definitions.html#Encounter.identifier">FHIR Encounter identifier</a> attribute of the current encounter in context</td>
</tr>
<tr>
<td><code class="prettyprint">context</code> <em>object</em></td>
<td>Hook-specific contextual data that the CDS service will need.<br />For example, with the <code class="prettyprint">medication-prescribe</code> hook this will include <a href="https://www.hl7.org/fhir/medicationorder.html">MedicationOrder</a> being prescribed.</td>
</tr>
<tr>
<td><code class="prettyprint">prefetchData</code> <em>object</em></td>
<td>The FHIR data that was prefetched by the EHR (see more information below)</td>
</tr>
</tbody></table>

<h4 id="hookinstance">hookInstance</h4>

<p>While working in the EHR, a user can perform
multiple activities in series or in parallel. For example, a clinician might prescribe
two drugs in a row; each prescription activity would be assigned a
unique <code class="prettyprint">hookInstance</code>. The [[activity catalog|Activity]]
provides a description of what events should initiate and terminate
a given hook. This allows an external
service to associate requests with activity state, which is necessary to
support the following app-centric decision sequence, where
the steps are tied together by a common <code class="prettyprint">hookInstance</code>:</p>

<ol>
<li>EHR invokes CDS hook</li>
<li>CDS service returns <em>app link card</em></li>
<li>User clicks app link and interacts with app</li>
<li>Flow returns to EHR, which re-invokes CDS hook</li>
<li>CDS service returns <em>decision</em> with user&rsquo;s choice</li>
</ol>

<p>Note: the <code class="prettyprint">hookInstance</code> is globally unique and should contain enough entropy
to be un-guessable.</p>

<h4 id="oauth">oauth</h4>

<p>Security details allowing the CDS service to connect to the EHR&rsquo;s
FHIR server.  These fields allow the CDS service to access EHR data in a
context limited by the current user&rsquo;s privileges. <code class="prettyprint">expires</code> expresses the
token lifetime as an integer number of seconds. <code class="prettyprint">scope</code> represents the set of
scopes assigned to this token (see <a href="http://docs.smarthealthit.org/authorization/scopes-and-launch-context/">SMART on FHIR
scopes</a>).
Finally, <code class="prettyprint">token</code> is a bearer token to be presented with any API calls the CDS
service makes to the EHR, by including it in an Authorization header like:</p>

<p><code class="prettyprint">Authorization: Bearer {{token}}</code></p>

<h4 id="redirect">redirect</h4>

<p>This field is only used by services that will return an <em>app
link card</em>: when a user clicks the card&rsquo;s link to launch an app, it becomes
the app&rsquo;s job to send the user to <em>this <code class="prettyprint">redirect</code> URL</em> upon completion of
user interaction. (<em>Design note</em>: this field is supplied up-front, as part of
the initial request, to avoid requiring the EHR to append any content to app
launch links. This helps support an important &ldquo;degenerate&rdquo; use case for app
link cards: pointing to static content. See below for details.)</p>

<h4 id="prefetch">prefetch</h4>

<p>As a performance tweak, the EHR may pass along data according
to the service&rsquo;s [[Prefetch-Template]]. This helps provide the service with all
the data it needs to efficiently compute a set of recommendations. Each key matches a key described in the CDS Service Discovery document; and each value is a FHIR Bundle.entry indicating a response status and returned resource.</p>

<p>Note that in the absence of <code class="prettyprint">prefetch</code>, an external service can always execute
FHIR REST API calls against the EHR server to obtain additional data ad-hoc.)
An EHR calls a CDS service by <code class="prettyprint">POST</code>ing a JSON document to the service
endpoint, which can be constructed from the CDS Service base URL and an
individual serviec id as <code class="prettyprint">{baseUrl}/cds-services/{service.id}</code>.</p>

<aside class="notice">
You can see the <a href="http://editor.swagger.io/#/?import=https://raw.githubusercontent.com/cds-hooks/api/master/cds-hooks.yaml?token=AATHAQY8vqQ6dIZajRuuE55EWMBitTptks5XLMk6wA%3D%3D">complete data model in Swagger</a>.
</aside>

<h2 id="cds-service-response">CDS Service Response</h2>
<pre class="highlight shell"><code><span class="o">{</span>
  cards:                   0..<span class="k">*</span> <span class="o">{</span>
    summary:              1..1,
    detail:               0..1,
    indicator:            1..1,
    <span class="nb">source</span>:               1..1 <span class="o">{</span>
      label:              1..1,
      url:                0..1
    <span class="o">}</span>,
    suggestions:           0..<span class="k">*</span> <span class="o">{</span>
      label:              0..1,
      create:             0..<span class="k">*</span>,
      delete:             0..<span class="k">*</span>
    <span class="o">}</span>,
    links:                 0..<span class="k">*</span> <span class="o">{</span>
      label:              0..1,
      url:                0..1
    <span class="o">}</span>
  <span class="o">}</span>,
  decisions:               0..<span class="k">*</span> <span class="o">{</span>
    create:               0..<span class="k">*</span>,
    delete:               0..<span class="k">*</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>

<blockquote>
<p>Example response</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"cards"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Success Card"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"indicator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is an example success card."</span><span class="p">,</span><span class="w">
      </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Static CDS Service Example"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.com"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Google"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://google.com"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Github"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Info card"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"indicator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"info"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Static CDS Service Example"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><strong><code class="prettyprint">cards</code></strong> CDS results for the EHR to present to the user. Cards can provide a 
combination of information (for reading), suggested actions (to be applied if a user
selects them), and links (to launch an app if the user selects them). The EHR decides
how to display cards, but we recommend displaying suggestions using buttons, and
links using underlined text.</p>

<p><strong><code class="prettyprint">cards.summary</code></strong> one-sentence, &lt;140-character summary message for display to
the user inside of this card.</p>

<p><strong><code class="prettyprint">cards.detail</code></strong> optional detailed information to display, represented in Markdown. (For
non-urgent cards, the EHR may hide these details until the user clicks a link like
&ldquo;view more details&hellip;&rdquo;.)</p>

<p><strong><code class="prettyprint">cards.indicator</code></strong>  urgency/importance of what this card
conveys. Allowed values, in order of increasing urgency, are: <code class="prettyprint">success</code>,
<code class="prettyprint">info</code>, <code class="prettyprint">warning</code>, <code class="prettyprint">hard-stop</code>. The EHR can use this field to
help make UI display decisions such as sort order or coloring. The value 
<code class="prettyprint">hard-stop</code> indicates that the workflow <strong>should not be allowed to proceed</strong>. </p>

<p><strong><code class="prettyprint">cards.source</code></strong> grouping structure for a short, human-readable description (in <code class="prettyprint">source.label</code>)
of the source of the information displayed on this card, with an optional link (in <code class="prettyprint">source.url</code>) 
where the user can learn more about the organization or data set that provided
the information on this card. Note that <code class="prettyprint">source.url</code> should <strong>not</strong> be used to
supply a context-specific &ldquo;drill-down&rdquo; view of the information on this card. For that,
use <code class="prettyprint">link.url</code> instead.</p>

<p><strong><code class="prettyprint">cards.suggestions</code></strong> grouping structure for <em>suggestion cards</em>, which allow a service
to suggest a set of changes in the context of the current activity
(e.g.  changing the dose of the medication currently being prescribed, for the
<code class="prettyprint">medication-prescribe</code> activity)</p>

<p><strong><code class="prettyprint">cards.suggestions.label</code></strong> human-readable label to display for this suggestion
(e.g. the EHR might render this as the text on a button tied to this
suggestion).</p>

<p><strong><code class="prettyprint">cards.suggestions.create</code></strong> new resource(s) that this suggestion
applies within the current activity (e.g. for <code class="prettyprint">medication-prescribe</code>, this
holds the updated prescription as proposed by the suggestion).</p>

<p><strong><code class="prettyprint">cards.suggestions.delete</code></strong> id(s) of any resources to remove from the current
activity (e.g. for the <code class="prettyprint">order-review</code> activity, this would provide a way to
remove orders from the pending list). In activities like <code class="prettyprint">medication-prescribe</code>
where only one &ldquo;content&rdquo; resource is ever relevant, this field may be omitted.</p>

<p><strong><code class="prettyprint">cards.links</code></strong> grouping structure for a link to an app that the user
might want to run for additional information or to help guide a decision.</p>

<p><strong><code class="prettyprint">cards.links.label</code></strong> human-readable label to display for this link (e.g. the EHR
might render this as the underlined text of a clickable link).</p>

<p><strong><code class="prettyprint">cards.links.url</code></strong> URL to load when a user clicks on this link. Note that this
may be a &ldquo;deep link&rdquo; with context embedded in path segments, query parameters,
or a hash. In general this URL should embed enough context for the app to
determine the <code class="prettyprint">activityInstance</code>, and <code class="prettyprint">redirect</code> url upon downstream
launch, because the EHR will simply use this url as-is, without appending any parameters
at launch time.</p>

<p><strong><code class="prettyprint">decisions</code></strong> grouping structure representing a decision to be applied directly to
the user session. Note that a CDS service may only return a <code class="prettyprint">decision</code> after
interacting with the user through an app link. Decisions are designed to convey
any choices the user made in an app session.</p>

<p><strong><code class="prettyprint">decisions.create</code></strong> new resource(s) that the EHR should create within the
current activity (e.g. for <code class="prettyprint">medication-prescribe</code>, this would be the updated
prescription that a user had authored in an app session).</p>

<p><strong><code class="prettyprint">decisions.delete</code></strong> id(s) of any resources to remove from the current
activity (e.g. for the <code class="prettyprint">order-review</code> activity, this would provide a way to
remove orders from the pending list). In activities like <code class="prettyprint">medication-prescribe</code>
where only one &ldquo;content&rdquo; resource is ever relevant, this field may be omitted.</p>

          <h1 id="prefetch">Prefetch</h1>

<h2 id="a-performance-tweak">A performance tweak</h2>

<p>If real-world performance were no issue, an EHR could launch a CDS Service
passing only <em>context</em> data, and <em>without passing any additional clinical data</em>
up-front. The CDS Service could then request any data it needed via the EHR&rsquo;s
FHIR REST API.</p>

<p>But CDS services must respond quickly (on the order of 500 ms), and so we
provide a performance tweak that allows an app to register a set of &ldquo;prefetch
templates&rdquo; with the EHR ahead of time.</p>

<p>The prefetch templates are a dictionary <code class="prettyprint">read</code> and <code class="prettyprint">search</code> requests to supply
relevant data, where the following variables are defined:</p>

<table><thead>
<tr>
<th>variable</th>
<th>meaning</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">{{Patient.id}}</code></td>
<td>The id of the patient in context for this activity (e.g. <code class="prettyprint">123</code>)</td>
</tr>
<tr>
<td><code class="prettyprint">{{User.id}}</code></td>
<td>The type and id of the user for this session (e.g. <code class="prettyprint">Practitioner/123</code>)</td>
</tr>
</tbody></table>

<p>Before calling the CDS Service, the EHR will fill out this template, replacing
<code class="prettyprint">{{Patient.id}}</code> with the id of the current patient (e.g. <code class="prettyprint">123</code>) inside of any
URL strings. The EHR then executes the requests in the template as a set of
FHIR <code class="prettyprint">read</code> and <code class="prettyprint">search</code> operations (exactly as though they had been submitted
to the server&rsquo;s &ldquo;transaction&rdquo; endpoint as a FHIR batch-type bundle).</p>

<p>The resulting response, which must be rendered in a single page — no &ldquo;next
page&rdquo; links allowed — is passed along to the CDS Service using the
<code class="prettyprint">prefetch</code> parameter (see below for a complete example).</p>

<h2 id="example-prefetch-request">Example prefetch request</h2>
<pre class="highlight plaintext"><code>"prefetch": {
  "p": "Patient/{{Patient.id}}",
  "a1c": "Observation?patient={{Patient.id}}&amp;code=4548-4&amp;_count=1&amp;sort:desc=date"
}
</code></pre>

<p>Here is an example prefetch property from a CDS service discovery endpoint. The
goal is to know, at call time:</p>

<ul>
<li>Patient demographics</li>
<li>Most recent Hemoglobin A1c reading for this patient</li>
</ul>

<h2 id="example-prefetch-response">Example prefetch response</h2>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"prefetch"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"p"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200 OK"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"resource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"male"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"birthDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1974-12-25"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;snipped for brevity&gt;"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"a1c"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200 OK"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"resource"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bundle"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"searchset"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"entry"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
          </span><span class="nt">"resource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Observation"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
                </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://loinc.org"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4548-4"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hemoglobin A1c"</span><span class="w">
              </span><span class="p">}]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;snipped for brevity&gt;"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The response is augmented to include two prefetch values, where the dictionary
keys match the request keys (<code class="prettyprint">p</code> and <code class="prettyprint">a1c</code> in this case).</p>

<p>Note that a missing key indicates that an EHR has not attempted to supply a
given prefetch value; the CDS service can issue the request manually at call
time to fetch the required data.&ldquo;</p>

          <h1 id="hook-catalog">Hook Catalog</h1>

<h2 id="pre-defined-cds-hooks">Pre-defined CDS hooks</h2>

<p>We describe a set of hooks to support common use cases out of the box.
But <strong>this is not a closed set</strong>; anyone can define new hooks to address new use
cases. To propose a new hooks please add it to the <a href="https://github.com/cds-hooks/docs/wiki/Proposed-Hooks">proposed hooks</a> page of our wiki.</p>

<p>Note that each hook (e.g. <code class="prettyprint">medication-prescribe</code>) represents something the user is doing in the EHR; various hooks might respond to the same hook (e.g. a &ldquo;price check&rdquo; service and a &ldquo;prior authorization&rdquo; service might both respond to <code class="prettyprint">medication-prescribe</code>).</p>

<p>Note also that each hook name in our official catalog is a simple string. If
you want to define custom hooks without submitting them to the catalog, then
you should use a URI (e.g.
<code class="prettyprint">http://my-organization/custom-hooks/patient-transmogrify</code>).</p>

<h2 id="medication-prescribe"><code class="prettyprint">medication-prescribe</code></h2>

<p><strong>Purpose</strong>: Inform an external CDS service that the user is in the process of
prescribing a new medication, and solicit feedback about the
prescription-in-progress.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"context"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MedicationPrescription"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"medicationCodeableConcept"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;snipped for brevity&gt;"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><strong>Contextual data</strong>: The set of proposed medication prescriptions. using the
FHIR <code class="prettyprint">MedicationPrescription</code> resource. See example in the sidebar.</p>

<h2 id="order-review"><code class="prettyprint">order-review</code></h2>

<p><strong>Purpose</strong>: Inform an external CDS service that the user is in the process of
reviewing a set of orders (sometimes known as a &ldquo;shopping cart&rdquo;), and solicit
feedback about the orders being reviewed.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"context"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DiagnosticOrder"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;snipped for brevity&gt;"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><strong>Contextual data</strong>: The set of orders being reviewed on-screen, represented
using a combination of MedicationOrder, DiagnosticOrder, DeviceUseRequest,
ReferralRequest, and ProcedureRequest. See example in the sidebar.</p>

<h2 id="patient-view"><code class="prettyprint">patient-view</code></h2>

<p><strong>Purpose</strong>: Inform an external CDS service that the user has just opened a new
patient record and is viewing a summary screen or &ldquo;face sheet&rdquo;, and solicit
feedback about this patient.</p>

<p><strong>Contextual data</strong>: None required beyond default context.</p>

          <h1 id="community">Community</h1>

<h2 id="get-involved">Get Involved</h2>

<p>There are several ways in which you can get involved with the CDS Hooks community.</p>

<ul>
<li>Ask a question and participate in discussions via the <a href="https://groups.google.com/forum/#!forum/cds-hooks">CDS Hooks Google Group</a></li>
<li>Chat via <a href="https://zulip.org/">Zulip</a> at <a href="https://chat.fhir.org">https://chat.fhir.org</a> in the <em>cds-hooks</em> stream</li>
<li>Contribute to the <a href="https://github.com/cds-hooks">code and documentation on Github</a></li>
</ul>

<h2 id="cds-hooks-sprint-program">CDS Hooks Sprint Program</h2>

<h3 id="objectives">Objectives</h3>

<ul>
<li>Promote creation of clinical-grade service integrations (EHRs + CDS Services)</li>
<li>Gain implementation experience with real-world systems</li>
<li>Refine the spec, balancing ease of use, flexibility, and stability</li>
<li>Drive toward pilot deployments with the ability to measure results</li>
</ul>

<h3 id="technical-objectives">Technical Objectives</h3>

<ol>
<li><p>Decide <a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/9">expectations for <code class="prettyprint">preFetch</code> behavior</a>
&ndash;&gt; possibly define an open-source gateway to smooth over the difference</p></li>
<li><p>Determine an <a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/10">approach to publishing metadata</a> (&ldquo;JSON snippets&rdquo;)</p></li>
<li><p>~~Evaluate approaches to conveying inputs/outputs in <a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/11">&ldquo;simple&rdquo; (i.e. normal) JSON</a>~~</p></li>
<li><p>Determine an <a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/12">approach to security (authentication/authorization)</a></p></li>
</ol>

<ul>
<li>CDS Service needs to authenticate the EHR &ndash;&gt; OAuth interaction</li>
<li>EHR needs to authenticate the service &ndash;&gt; simple bearer tokens</li>
</ul>

<h3 id="ways-to-help">Ways to help</h3>

<h5 id="help-build-out-core-infrastructure">Help build out core infrastructure</h5>

<ol>
<li><a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/1">Write a service exposing Card fixtures for testing</a></li>
<li><a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/2">Write a tutorial</a></li>
<li><a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/3">Write a preFetch Proxy</a></li>
<li>Write a set of test hook <em>calls</em></li>
</ol>

<h5 id="build-your-own-components">Build your own components:</h5>

<ol>
<li>CDS services</li>
<li>EHR support</li>
</ol>

<h3 id="pilot-opportunities">Pilot Opportunities</h3>

<ul>
<li>BCH/Cerner building support for prescription hooks</li>
<li>Others?</li>
</ul>

<h2 id="create-a-cds-hook">Create a CDS Hook</h2>

<ol>
<li>Listen at {{base}}/$cds-hook</li>
<li>Expose metadata at {{base}}/$cds-hook-metadata</li>
<li>Load into test harness and try it</li>
</ol>

<h2 id="sprint-1-two-weeks">Sprint 1 (two weeks)</h2>

<h4 id="infrastructure">Infrastructure:</h4>

<ul>
<li>Establish a <a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/4">repository of &ldquo;test cards&rdquo;</a></li>
<li>Stand up a <a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/5">&ldquo;test card service&rdquo;</a> to host them (fixtures)</li>
<li><a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/6">Build a &ldquo;CDS invoker&rdquo; that simulates an EHR</a>, invoking external services with fixed payloads </li>
</ul>

<h4 id="ehr-participants">EHR participants:</h4>

<ul>
<li>Call a CDS Service for <code class="prettyprint">patient-view</code> activity</li>
<li>Display text cards inline</li>
</ul>

<h4 id="cds-service-participants">CDS Service participants:</h4>

<ul>
<li>Build a CDS Service responding to <code class="prettyprint">patient-view</code> activity</li>
<li>&ldquo;Information cards&rdquo; only (plain text), for a start</li>
</ul>

<h2 id="sprint-2-two-weeks">Sprint 2 (two weeks)</h2>

<h4 id="infrastructure">Infrastructure:</h4>

<ul>
<li>Build a <a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/7">&ldquo;card validator&rdquo;</a> that provides rapid, automated feedback if cards have errors</li>
<li><a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/8">Integrate &ldquo;card validator&rdquo; into &ldquo;test EHR&rdquo;</a></li>
</ul>

<h4 id="ehr-participants">EHR participants:</h4>

<ul>
<li>Display <code class="prettyprint">app link</code> cards, and <code class="prettyprint">information</code> cards with markdown, inline</li>
<li>Ensure that FHIR API endpoint is included in service calls</li>
</ul>

<h4 id="cds-service-participants">CDS Service participants:</h4>

<ul>
<li>Return <code class="prettyprint">app link</code> cards and <code class="prettyprint">information</code> card with markdown, inline</li>
</ul>

<h2 id="sprint-3-two-weeks">Sprint 3 (two weeks)</h2>

<h4 id="infrastructure">Infrastructure:</h4>

<ul>
<li><p>Build a <a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/3">&ldquo;preFetch proxy&rdquo;</a> to automatically produce preFetch data when unavailable from EHR</p></li>
<li><p>Write a <a href="https://github.com/cds-hooks/cds-hooks-wiki/issues/2">CDS Service developer&rsquo;s tutorial</a></p></li>
</ul>

<h4 id="ehr-participants">EHR participants:</h4>

<ul>
<li>Build support for <code class="prettyprint">preFetch</code> data ?</li>
</ul>

<h4 id="cds-service-participants">CDS Service participants:</h4>

<ul>
<li>Set up automated testing with the CDS Invoker</li>
</ul>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="code">code</a>
          </div>
      </div>
    </div>
  </body>
</html>
